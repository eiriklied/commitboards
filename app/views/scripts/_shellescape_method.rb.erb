#!/usr/bin/env ruby

# from http://svn.ruby-lang.org/repos/ruby/trunk/lib/shellwords.rb
def shellescape(str)
  # An empty argument will be skipped, so return empty quotes.
  return "''" if (str.nil? || str.empty?)

  str = str.dup

  # Process as a single byte sequence because not all shell
  # implementations are multibyte aware.
  str.gsub!(/([^A-Za-z0-9_\-.,:\/@\n])/n, "\\\\\\1")

  # A LF cannot be escaped with a backslash because a backslash + LF
  # combo is regarded as line continuation and simply ignored.
  str.gsub!(/\n/, "'\n'")

  return str
end
